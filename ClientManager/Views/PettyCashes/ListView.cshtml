@model IEnumerable<DBOperation.PettyCash>

@{
    var currentUser = (ClientManager.Models.UserDetails)Session["UserDetails"];
}

<style>
    table tr td:first-child {
        white-space: nowrap;
    }

    table thead tr th {
        white-space: nowrap;
    }
</style>

<table id="example1" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Action</th>
            <th>
                Amount Received
            </th>
            <th>
                Amount Recived Date
            </th>
            <th>
                Mode of Payment
            </th>

            <th>
                Description
            </th>
            <th>
                Status
            </th>
            <th>
                Created On
            </th>
            <th>
                Created By
            </th>
            <th>
                Modified On
            </th>
            <th>
                Modified By
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @if (item.Status == "Pending")
                    {
                        <button type="button" class="btn btn-primary btn-xs" title="Edit" onclick="javascript:location.href='/PettyCashes/Edit/@item.Id'"><i class="far fa-edit"></i></button>
                    }
                    @*<button type="button" class="btn btn-success btn-xs" title="View" onclick="javascript:location.href='/Admin/User/Details/@item.Id'"><i class="fas fa-eye"></i></button>*@

                    @if (userData.UserRoles.Any(wh => wh.RoleName == "Admin") && item.Status == "Pending")
                    {
                        <button type="button" class="btn btn-outline-success btn-xs" title="Approve" onclick="fnApprove(@item.Id,'Approved')"><i class="far fa-arrow-alt-circle-right"></i></button>
                        @*<button type="button" class="btn btn-outline-secondary btn-xs" title="Verify" onclick="fnVerify(@item.Id,'Verified')"><i class="far fa-arrow-alt-circle-up"></i></button>*@
                    }

                    @if (userData.UserRoles.Any(wh => wh.RoleName == "Finance") && item.Status == "Approved")
                    {
                        <button type="button" class="btn btn-outline-success btn-xs" title="Verify" onclick="fnVerify(@item.Id,'Verified')"><i class="far fa-arrow-alt-circle-left"></i></button>
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.AmountReceived)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.AmountRecivedDate)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ModeOfPayment)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CreatedOn)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.User.FullName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ModifiedOn)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.User1.FullName)
                </td>
            </tr>
        }
    </tbody>
</table>

<script>
    $(function () {
        $("#example1").DataTable({
            "responsive": true, "lengthChange": false, "autoWidth": false,
            "buttons": ["excel", "pdf", "print", "colvis"]
        }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
        $('#example2').DataTable({
            "paging": true,
            "lengthChange": false,
            "searching": false,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
        });
    });

    function fnApprove(id, status) {
        $.ajax({
            type: "GET",
            url: "/PettyCashes/PettyCashApprove?id=" + id + "&status=" + status,
            //data: JSON.stringify(Register),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data.status == "Success") {
                    alert(data.message);
                    window.location.href = data.redirectURL;
                }
                //else {
                //    alert(data.message);
                //}

            },
            error: function () {
                alert("Error occured!!  " + data.message)
            }
        });
    }
    function fnVerify(id, status) {
        $.ajax({
            type: "GET",
            url: "/PettyCashes/PettyCashVerify?id=" + id + "&status=" + status,
            //data: JSON.stringify(Register),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data.status == "Success") {
                    alert(data.message);
                    window.location.href = data.redirectURL;
                }
                //else {
                //    alert(data.message);
                //}

            },
            error: function () {
                alert("Error occured!!  " + data.message)
            }
        });
    }
</script>